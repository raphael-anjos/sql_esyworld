--Identifica pedidos que obtiveram chaves integradas a Kaspersky
select ped.id, ped.IdAfiliado, ped.DataFinalizacao, item.Id, item.IdPedido, IdProdutoOpcao, item.Quantidade, item.PedidoKorm, item.ChaveAtivacaoKorm
from [dbo].[Pedido] as ped right join [dbo].[PedidoItem] as item
on ped.Id = item.IdPedido
where Convert(date,ped.DataFinalizacao,23) = '2023-02-10' and item.PedidoKorm is not null

-------
SELECT '7' AS indice, * from [dbo].[ProdutoLicenca] where chave in ('2XBCJ-S1BBA-A513C-ZVJ21','STTFT-M5825-CG1G3-XSG6J','95YEJ-XBXWS-ZB86M-V6J77','ET6UA-11URH-SH1BB-SWJGB','K2Z26-XC7H8-T1YEB-G3UYZ','SVRQQ-4HV8G-MMG7W-ZUSPH','TA8N4-BW1FZ-DKT1Z-BMEQU','7PF59-K83BU-BRXC1-RV15Y','3FTSB-J9S4P-QGSEX-H9RNR','N25D6-HH5WX-YPTYJ-AXX62')
SELECT '8' AS indice, * from [dbo].[ProdutoLicenca] where chave in ('VAKC1-ZNSK9-XX3JM-UETUA','7P7TF-ECJPV-DWYET-Q6Z9H','Z1KZZ-1XNQW-RUMTB-9HVQG','BEKZ6-5ZX87-TQHVK-WC8CQ','A5GT9-54EHG-2SKSA-EMA88','5GWHT-N3V7Z-8CE84-R582J','GTQTW-T2KCR-EDB3P-JV3ZM','NF8EG-NHY9E-5674J-14WKR','Q63K9-DSPDT-P5VDX-AJ53T','JMTH1-55CN5-DJJX9-3W8HX')
SELECT '9' AS indice, * from [dbo].[ProdutoLicenca] where chave in ('T9CKX-BGGV6-EFHNJ-5JUAW','A4BAM-EBZJY-9REN7-DJYAF','QXG8X-NKWEV-KA2VN-1QJYJ','JU56U-6S5ZZ-6YDF5-H2DGA','AT2PZ-YGT42-GT2NP-QNEZY','R1MWQ-9SVST-7SMUJ-56FAC','Q46TY-KBEJW-FF36X-TP7UW','D3MMU-AS82U-E64QC-AMT2H','6ET7M-YRTTN-VXUZD-KA22W','3AV22-51XMY-6Z2S9-4G3S7')
SELECT '10' AS indice, * from [dbo].[ProdutoLicenca] where chave in ('9EPQ6-H84GA-CCWM4-2UT8X','T6YXT-N1R7C-WEU8J-CFMQW','1G6Z4-4V48U-Q7175-2ZMA6','DD9PK-EUJBX-F4NSV-1X21J','GSCAM-SK55Z-FKRHU-EQ3AA','95XUG-EY9FQ-ZV1QC-CAM2J','4SEM1-4DT8A-766XS-RGK2Q','H1S4E-JU6W9-Z5H3R-6HMTY','ASQPF-YQJ9F-R3MMN-XNZE1','P1G2C-DPBYG-UXEXQ-DWUH3')
SELECT '11' AS indice, * from [dbo].[ProdutoLicenca] where chave in ('6UEQ9-TAT46-36X4D-6R5CH','UGPQW-7SZF3-JHYB7-553UJ','TR21F-V97PM-2T6V1-JTNBZ','AH44B-K53KT-NC9SC-GUWM8','BE3AE-JPCY7-A15F8-VJVMJ','AT8UZ-QSHX2-CNY2Q-3HZ5Y','WGT2M-3U71X-PKYNH-2EBNT','J55MC-7PU9W-PQSTX-JA4NE','QGJZA-E5WYX-8P6ZY-J16MD','WRSV9-PPPJC-UQC3W-4KYCE')
SELECT '19' AS indice, * from [dbo].[ProdutoLicenca] where chave in ('NKX35-UTBGH-SVAKZ-FQDSZ','ARP46-TDER4-TFCR4-ASAH5','RTS1B-B87ZB-KUYCJ-3R42U','UNRSX-9G32C-Z6R9D-Z8ZMV','GV8CF-HQ861-E6GZV-RYVHB','9JERJ-BSFCD-W1KM2-TYEXX','KQASQ-JHTWX-5TANK-KB17T','JFQAF-BBPUM-FUKWR-QS5H5','1RU3N-E6J6W-6QT5H-DB3AM','6Z61C-7YJ3H-731E3-BSF2Q')
SELECT '20' AS indice, * from [dbo].[ProdutoLicenca] where chave in ('RE3W1-A6756-XFRQN-4RB97','H9SJU-ZFJCP-QTPSD-9KHYS','UDVTJ-9K3RU-XE3X4-CC2D3','MNPPG-9MKMP-C579K-EZWHR','VJDWX-GNAC7-1MB8B-BJPT3','WZEQR-DURB5-13TE5-XGH7Z','44NMP-WFY46-YA8V7-7JDZF','W95NF-KH25K-6JQ7Q-BCYSX','QZ21H-3R3N4-KHEEB-P5F9N','HY8KB-GFK8W-A48VH-4DVHF')
SELECT '21' AS indice, * from [dbo].[ProdutoLicenca] where chave in ('XMUGQ-H4436-8E3P3-243NN','9F3G9-A2D8R-2V626-4VJH7','3FE8Z-Y72NE-8QSRG-PQEJN','X4C7X-H5GYK-8DADT-49Y4X','YUPVZ-N1A6E-HFREJ-Q7FPZ','KSJQB-USYWA-9MKMR-P6VCH','84NEC-ZWRX2-UV1YR-EUDT2','KXWMQ-WBF6J-GG1AC-E6B6N','HPGEJ-PP7HT-614QT-G3JQ4','U6W9B-C6TVR-QFQ73-G7DDB')
SELECT '22' AS indice, * from [dbo].[ProdutoLicenca] where chave in ('QQAHC-N85E6-YXXR2-HWP3V','6NAM9-KMRQ8-PTYMV-NATNV','9D7R9-3ZJC8-KQYY1-6H5CB','X5DFX-6JE94-T63UC-BF1U7','J2KYB-CWTHG-92AJB-6BDAC','274DJ-VMBDJ-NDWD6-2WX2R','GXPWE-ADGY5-B9DUD-48B7P','7X5SN-8C386-FPV6Q-RRHJU','DMUQ7-Q51MY-VKBY7-E8ZKP','WGCRE-URFKJ-ZPQQM-UC6D1')
SELECT '39' AS indice, * from [dbo].[ProdutoLicenca] where chave in ('HED74-8B26Q-B42AT-YN2A7','9EN33-YMUM2-431XA-9J9FV','G996N-3YVAZ-5VPFW-4BRUF','4KK3C-2B6A4-TU369-A4XUD','VG17V-ZTM6P-M7BRU-B5MHB','65278-PQF51-CR1P3-1HMK2','CVMXE-U2BVM-7FWQF-RV5TQ','GMTQH-V1GT4-YQ12U-8SR1T','4XBBZ-FT71V-FPR22-4JC21','PNEZJ-QDVXC-M69BU-EW1EU')
SELECT '41' AS indice, * from [dbo].[ProdutoLicenca] where chave in ('PGNJP-AGKS4-4JPJ8-E5269','9RXT3-PSNSW-GE3AA-5BS23','435RD-1N1CN-53CXG-BTNPP','QRKYF-MK3VC-75S8X-GEZRP','H9P38-SDCY6-HVJDF-8QM2N','FJQ61-DDKUQ-RR91W-U9JUB','7YTYW-BCVZM-R66BA-7KE6S','PACNM-7FBFN-1H4Q4-W7NCB','858JG-T2HC5-5M6GR-YJ6Z2','VKSGN-J9Q3G-JHEA2-XZCRP')
SELECT '42' AS indice, * from [dbo].[ProdutoLicenca] where chave in ('KM1S1-6514A-8VQSU-2BQ8R','DVJQV-ZY4NC-Z9V3Y-J3V2F','ZH9Q6-UGF9Z-CPF37-M5G7T','TCTYG-FESQ3-14NH4-6FC3B','3ZFV8-YUS25-W2ZW8-K4DMY','ZFF5X-UTS5S-PNN1B-F8EE1','BA23W-7TF54-QYX1Y-KZDT1','13A3W-AUWK2-ZMKG9-ZHV21','45STD-3CA5U-GS62Q-N7DXT','R97S4-3N51Z-ZXUNM-EQS4R')


--Chaves corrigidas
BEGIN TRANSACTION 
UPDATE [dbo].[ProdutoLicenca]
SET IdProdutoOpcao = 99
WHERE IdProdutoOpcao = 62 AND chave IN ('DVJQV-ZY4NC-Z9V3Y-J3V2F','ZH9Q6-UGF9Z-CPF37-M5G7T','TCTYG-FESQ3-14NH4-6FC3B')
COMMIT;

SELECT * FROM ProdutoOpcao WHERE id IN (62,99)
